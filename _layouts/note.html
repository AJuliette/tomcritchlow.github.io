{% include head.html %}

{% include googleanalytics.html %}

{% include header.html %}

<div class="mw8 center lh-copy f4 postcontainer ph3 ph0-l">
    <div class="pt4 pt5-l w-two-thirds-ns">
  
        <h1 class="f2 f1-l fw8 lh-solid mv1 posttitle">{{page.title}}</h1>
  
      {% if page.subtitle %}
      <h2 class="f3 fw3 lh-copy mv1 subtitle">{{page.subtitle}}</h2>
        {% endif %}
  
    </div>
    
    
    <div class="w-two-thirds-ns">
  
  {{content}}
                                    
      <div class="bg-washed-green pa2 bi-links">
        Notes linking to this one:

      </div>

</div>
</div>

<script>
    $( document ).ready(function() {
      var regex = /\[\[(.+?)\]\]/g;
      var notes_array = [];
      var pagelinks_array = [];
      var page_name = decodeURIComponent(window.location.pathname.split("/")[2]);

      $(".postcontainer").html(function(i, html) { 
      pagelinks_array.push(html.match(regex));  
      return html.replace(regex, "<a class='notelink' data-note-title='$1' href='/notes/$1'>$1</a>");
      });
      
      $.getJSON("/notes.json", function(results){
        console.log(results);

        for(var i in results){
          notes_array.push(results[i]);
          notes_array[i].links = results[i].content.match(regex);
        };

        for(var note in notes_array){
          for(var i in notes_array[note].links){
            console.log(notes_array[note].links[i]);
            if(notes_array[note].links[i] == "[["+page_name+"]]"){
             $(".bi-links").append("<div><a href='"+notes_array[note].url+"'>"+notes_array[note].url+"</a></div>");
              console.log("match!")
            }
          }
        }

        $(".notelink").each(function(){
          
          $(this).append("<div class='notepreview'>Preview</div>")
        });

        console.log(notes_array);
        console.log(pagelinks_array);
      });

  }); 
  
  

  
  </script>  


{% include footer.html %}